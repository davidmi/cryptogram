<!DOCTYPE html>
<html>

<head>
	<script src="sjcl.js" type="text/javascript"></script>
</head>

<body>
	<p id="output"></p>
	
	<script type="text/javascript">
	
	// Read a page's GET URL variables and return them as an object.
	function getUrlVars()
	{
		var vars = [], hash;
		var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
		for(var i = 0; i < hashes.length; i++)
		{
		    hash = hashes[i].split('=');
		    vars.push(hash[0]);
		    vars[hash[0]] = hash[1];
		}
		return vars;
	}
	
	var args = getUrlVars();
	if (args.password !== undefined && args.data !== undefined){
		var encoded = JSON.parse(sjcl.encrypt(args.password, args.data));
		//call functions with workaround
		img = new Image();
		img.src = "|setIv|"+encoded['iv'];
		img.src = "|setCt|"+encoded['ct'];
		img.src = "|setSalt|"+encoded['salt'];
		//window.location = "http://example.com/|setSalt|"+encoded.salt;
		//window.location = "http://example.com/|setCt|"+encoded.ct;
		//dataAccessor.setIv(encoded['iv']);
		//dataAccessor.setCt
		document.getElementById("output").innerHTML = '<a href="http://example.com/|setIv|' + encoded.iv +'">Link</a>';
	}
	else{
		//Debug stuff
		document.getElementById("output").innerHTML = "failed";
	}
	</script>

</body>

</html>
