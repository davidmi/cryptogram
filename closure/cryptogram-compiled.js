function p(a){throw a;}var r=void 0,t=!0,u=null,z=!1;function B(a){return function(){return a}}var C,D=this;function aa(a,b){var c=a.split("."),d=D;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&b!==r?d[f]=b:d=d[f]?d[f]:d[f]={}}
function ba(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function da(a){var b=ba(a);return"array"==b||"object"==b&&"number"==typeof a.length}function E(a){return"string"==typeof a}Math.floor(2147483648*Math.random()).toString(36);function ea(a){var b=F;function c(){}c.prototype=b.prototype;a.Ka=b.prototype;a.prototype=new c};Math.random();var G=Array.prototype,fa=G.forEach?function(a,b,c){G.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,f=E(a)?a.split(""):a,e=0;e<d;e++)e in f&&b.call(c,f[e],e,a)};function ga(a){return G.concat.apply(G,arguments)}function ha(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]};var H,ia,I,ja;function ka(){return D.navigator?D.navigator.userAgent:u}ja=I=ia=H=z;var K;if(K=ka()){var la=D.navigator;H=0==K.indexOf("Opera");ia=!H&&-1!=K.indexOf("MSIE");I=!H&&-1!=K.indexOf("WebKit");ja=!H&&!I&&"Gecko"==la.product}var L=ia,ma=ja,na=I,oa;
a:{var M="",N;if(H&&D.opera)var pa=D.opera.version,M="function"==typeof pa?pa():pa;else if(ma?N=/rv\:([^\);]+)(\)|;)/:L?N=/MSIE\s+([^\);]+)(\)|;)/:na&&(N=/WebKit\/(\S+)/),N)var qa=N.exec(ka()),M=qa?qa[1]:"";if(L){var ra,sa=D.document;ra=sa?sa.documentMode:r;if(ra>parseFloat(M)){oa=String(ra);break a}}oa=M}var ta={};
function ua(a){if(!ta[a]){for(var b=0,c=String(oa).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),f=Math.max(c.length,d.length),e=0;0==b&&e<f;e++){var g=c[e]||"",h=d[e]||"",m=RegExp("(\\d*)(\\D*)","g"),n=RegExp("(\\d*)(\\D*)","g");do{var k=m.exec(g)||["","",""],l=n.exec(h)||["","",""];if(0==k[0].length&&0==l[0].length)break;b=((0==k[1].length?0:parseInt(k[1],10))<(0==l[1].length?0:parseInt(l[1],10))?-1:(0==k[1].length?0:parseInt(k[1],10))>
(0==l[1].length?0:parseInt(l[1],10))?1:0)||((0==k[2].length)<(0==l[2].length)?-1:(0==k[2].length)>(0==l[2].length)?1:0)||(k[2]<l[2]?-1:k[2]>l[2]?1:0)}while(0==b)}ta[a]=0<=b}}var va={};function wa(){return va[9]||(va[9]=L&&!!document.documentMode&&9<=document.documentMode)};!L||wa();!ma&&!L||L&&wa()||ma&&ua("1.9.1");L&&ua("9");function xa(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function ya(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};function O(a){return E(a)?document.getElementById(a):a};function za(a){if("function"==typeof a.h)return a.h();if(E(a))return a.split("");if(da(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return xa(a)};function P(a,b){this.i={};this.d=[];var c=arguments.length;if(1<c){c%2&&p(Error("Uneven number of arguments"));for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof P?(c=a.r(),d=a.h()):(c=ya(a),d=xa(a));for(var f=0;f<c.length;f++)this.set(c[f],d[f])}}C=P.prototype;C.b=0;C.ua=0;C.h=function(){Aa(this);for(var a=[],b=0;b<this.d.length;b++)a.push(this.i[this.d[b]]);return a};C.r=function(){Aa(this);return this.d.concat()};C.B=function(a){return Q(this.i,a)};
C.remove=function(a){return Q(this.i,a)?(delete this.i[a],this.b--,this.ua++,this.d.length>2*this.b&&Aa(this),t):z};function Aa(a){if(a.b!=a.d.length){for(var b=0,c=0;b<a.d.length;){var d=a.d[b];Q(a.i,d)&&(a.d[c++]=d);b++}a.d.length=c}if(a.b!=a.d.length){for(var f={},c=b=0;b<a.d.length;)d=a.d[b],Q(f,d)||(a.d[c++]=d,f[d]=1),b++;a.d.length=c}}C.get=function(a,b){return Q(this.i,a)?this.i[a]:b};C.set=function(a,b){Q(this.i,a)||(this.b++,this.d.push(a),this.ua++);this.i[a]=b};C.J=function(){return new P(this)};
function Q(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var Ba=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");function R(a,b){var c;if(a instanceof R)this.f=b!==r?b:a.f,Ca(this,a.w),c=a.X,S(this),this.X=c,c=a.C,S(this),this.C=c,Da(this,a.T),c=a.R,S(this),this.R=c,Ea(this,a.n.J()),c=a.K,S(this),this.K=c;else if(a&&(c=String(a).match(Ba))){this.f=!!b;Ca(this,c[1]||"",t);var d=c[2]||"";S(this);this.X=d?decodeURIComponent(d):"";d=c[3]||"";S(this);this.C=d?decodeURIComponent(d):"";Da(this,c[4]);d=c[5]||"";S(this);this.R=d?decodeURIComponent(d):"";Ea(this,c[6]||"",t);c=c[7]||"";S(this);this.K=c?decodeURIComponent(c):
""}else this.f=!!b,this.n=new T(u,0,this.f)}C=R.prototype;C.w="";C.X="";C.C="";C.T=u;C.R="";C.K="";C.Ba=z;C.f=z;C.toString=function(){var a=[],b=this.w;b&&a.push(U(b,Fa),":");if(b=this.C){a.push("//");var c=this.X;c&&a.push(U(c,Fa),"@");a.push(encodeURIComponent(String(b)));b=this.T;b!=u&&a.push(":",String(b))}if(b=this.R)this.C&&"/"!=b.charAt(0)&&a.push("/"),a.push(U(b,"/"==b.charAt(0)?Ga:Ha));(b=this.n.toString())&&a.push("?",b);(b=this.K)&&a.push("#",U(b,Ia));return a.join("")};C.J=function(){return new R(this)};
function Ca(a,b,c){S(a);a.w=c?b?decodeURIComponent(b):"":b;a.w&&(a.w=a.w.replace(/:$/,""))}function Da(a,b){S(a);b?(b=Number(b),(isNaN(b)||0>b)&&p(Error("Bad port number "+b)),a.T=b):a.T=u}function Ea(a,b,c){S(a);b instanceof T?(a.n=b,a.n.aa(a.f)):(c||(b=U(b,Ja)),a.n=new T(b,0,a.f))}function S(a){a.Ba&&p(Error("Tried to modify a read-only Uri"))}C.aa=function(a){this.f=a;this.n&&this.n.aa(a);return this};function U(a,b){return E(a)?encodeURI(a).replace(b,Ka):u}
function Ka(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Fa=/[#\/\?@]/g,Ha=/[\#\?:]/g,Ga=/[\#\?]/g,Ja=/[\#\?@]/g,Ia=/#/g;function T(a,b,c){this.e=a||u;this.f=!!c}function V(a){if(!a.a&&(a.a=new P,a.b=0,a.e))for(var b=a.e.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),f=u,e=u;0<=d?(f=b[c].substring(0,d),e=b[c].substring(d+1)):f=b[c];f=decodeURIComponent(f.replace(/\+/g," "));f=W(a,f);a.add(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}C=T.prototype;
C.a=u;C.b=u;C.add=function(a,b){V(this);this.e=u;var a=W(this,a),c=this.a.get(a);c||this.a.set(a,c=[]);c.push(b);this.b++;return this};C.remove=function(a){V(this);a=W(this,a);return this.a.B(a)?(this.e=u,this.b-=this.a.get(a).length,this.a.remove(a)):z};C.B=function(a){V(this);a=W(this,a);return this.a.B(a)};C.r=function(){V(this);for(var a=this.a.h(),b=this.a.r(),c=[],d=0;d<b.length;d++)for(var f=a[d],e=0;e<f.length;e++)c.push(b[d]);return c};
C.h=function(a){V(this);var b=[];if(a)this.B(a)&&(b=ga(b,this.a.get(W(this,a))));else for(var a=this.a.h(),c=0;c<a.length;c++)b=ga(b,a[c]);return b};C.set=function(a,b){V(this);this.e=u;a=W(this,a);this.B(a)&&(this.b-=this.a.get(a).length);this.a.set(a,[b]);this.b++;return this};C.get=function(a,b){var c=a?this.h(a):[];return 0<c.length?String(c[0]):b};
C.toString=function(){if(this.e)return this.e;if(!this.a)return"";for(var a=[],b=this.a.r(),c=0;c<b.length;c++)for(var d=b[c],f=encodeURIComponent(String(d)),d=this.h(d),e=0;e<d.length;e++){var g=f;""!==d[e]&&(g+="="+encodeURIComponent(String(d[e])));a.push(g)}return this.e=a.join("&")};C.J=function(){var a=new T;a.e=this.e;this.a&&(a.a=this.a.J());return a};function W(a,b){var c=String(b);a.f&&(c=c.toLowerCase());return c}
C.aa=function(a){if(a&&!this.f){V(this);this.e=u;var b=this.a,c=function(a,b){var c=b.toLowerCase();b!=c&&(this.remove(b),this.remove(c),0<a.length&&(this.e=u,this.a.set(W(this,c),ha(a)),this.b+=a.length))};if("function"==typeof b.forEach)b.forEach(c,this);else if(da(b)||E(b))fa(b,c,this);else{var d;if("function"==typeof b.r)d=b.r();else if("function"!=typeof b.h)if(da(b)||E(b)){d=[];for(var f=b.length,e=0;e<f;e++)d.push(e)}else d=ya(b);else d=r;b=za(b);f=b.length;for(e=0;e<f;e++)c.call(this,b[e],
d&&d[e])}}this.f=a};var X;function F(){}F.prototype.Y=B(t);F.prototype.name=B("Generic");function La(a){var b=X;b.z.Da=b.z.src;b.z.src=a};function Y(){}ea(Y);Y.prototype.Y=function(a){return RegExp(/^http:\/\/www.facebook.com/).test(a)};Y.prototype.name=B("Facebook context");function Ma(){}ea(Ma);Ma.prototype.Y=function(a){return RegExp(/^http:\/\/plus.google.com/).test(a)};Ma.prototype.name=B("Google Plus context");function Z(a,b){console.log(a);b&&(128<b.length&&(b=b.substring(0,128)+"\u2026"),console.log("   "+b))};function Na(a){a.lengthComputable&&Math.ceil(100*(a.loaded/a.total))};function Oa(){}Oa.prototype.getHeader=function(){var a=this.ta,b=this.sa,c=this.o,d="";for(y=0;8>y;y+=this.o)for(x=0;8>x;x+=2*this.o)base8_0=Pa(b,a.width,x,y,c,c),base8_1=Pa(b,a.width,x+c,y,c,c),base64Num=8*base8_0+base8_1,base64=this.oa.charAt(base64Num),d+=base64;return d};
function Qa(a){for(var b=a.ta,c=a.sa,d=a.o,f=0,e=a.y,g=z;0==a.pa||f<a.pa;){for(x=0;x<b.width;x+=2*d)if(!(e<a.ra&&x<a.ra)){base8_0=Pa(c,b.width,x,e,d,d);base8_1=Pa(c,b.width,x+d,e,d,d);if(-1==base8_0||-1==base8_1)break;base64Num=8*base8_0+base8_1;base64=a.oa.charAt(base64Num);a.H+=base64}f++;e+=d;if(e>=b.height){g=t;break}}a.y=e;_decoder=a;if(g){console.log(r);Z("Decoded "+a.H.length+" Base64 characters:",a.H);a:if(a=_decoder,e=a.H,f=e.substring(0,64),b=e.substring(64,86),c=e.substring(86,97),d=e.substring(97,
e.length),e=sjcl.hash.sha256.hash(e.substring(64,e.length)),sjcl.codec.hex.fromBits(e)!=f)Z("Checksum failed. Image is corrupted.");else{Z("Checksum passed.");f={};f.iv=b;f.salt=c;f.ct=d;var b=JSON.stringify(f),h;try{h=sjcl.decrypt(a.Ca,b)}catch(m){Z("Error decrypting:",m.toString());break a}Z("Decrypted "+h.length+" Base64 characters:",h);La("data:image/jpeg;base64,"+h)}}else h=Math.ceil(100*((e+4*d)/b.height)),100<h&&(h=100),console.log("Decode<br>"+h+"%"),setTimeout(function(){Qa(_decoder)},1)}
function Pa(a,b,c,d,f,e){var g=0,h=0;for(i=0;i<f;i++)for(j=0;j<e;j++)base=(d+j)*b+(c+i),green=a[4*base+1],h+=green,g++;v=h/g;a=Math.floor(v/28);return 0==a?-1:8<a?0:8-a};function $(){var a={t:"http://ianspiro.com/secret.jpg"};$.Ea=a;O("main").innerHTML='<input type="button" value="Decrypt" onClick="cryptogram.demo.decrypt()" id="button"><br><img src=\''+("object"===typeof a.t&&a.t&&0===a.t.Fa?a.t.content:String(a.t).replace(Ra,Sa))+"' id=image>";if(X==u)for(var a=new R(window.location),b=[Y,Ma,F],c,d=0;d<b.length;d++)c=new b[d],c.Y(a)&&(X=c)}
$.decrypt=function(){if($.qa)$.qa=z,O("button").value="Decrypt",La(X.z.Da);else{$.qa=t;O("button").value="Reset";var a=$.Ea.t,b,c=u;window.XMLHttpRequest?(c=new XMLHttpRequest,c.responseType="arraybuffer",c.addEventListener("progress",Na,z)):window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP"));b=c;b.onreadystatechange=function(){if(4==b.readyState){if("200"==b.status||"206"==b.status){var a=b.response;console.dir(a);var c;c="";for(var a=new Uint8Array(a),e=a.byteLength,g=e%3,e=e-g,h,m,
n,k,l=0;l<e;l+=3)k=a[l]<<16|a[l+1]<<8|a[l+2],h=(k&16515072)>>18,m=(k&258048)>>12,n=(k&4032)>>6,k&=63,c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[m]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[n]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k];1==g?(k=a[e],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&
3)<<4]+"=="):2==g&&(k=a[e]<<8|a[e+1],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&16128)>>8]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&15)<<2]+"=");c="data:image/jpeg;base64,"+c;Z("Downloaded image as Base64:",c);a=O("image");X.z=a;g=[];g.push(a);var s=g[0],q=new Oa;q.oa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var w=document.createElement("canvas"),
J=w.getContext("2d"),A=new Image;blockSize=2;A.onload=function(){w.width=A.width;w.height=A.height;J.drawImage(A,0,0);var a=J.getImageData(0,0,w.width,w.height).data;q.ta=A;q.sa=a;q.o=blockSize;q.ra=4*blockSize;q.Ca="cryptogram";q.z=s;q.pa=A.height/40;q.y=0;q.H="";a=q.getHeader();Z("Found '"+a+"' protocol");console.log(a);"aesthete"!=a?(Z("Error: Unknown Protocol"),X.get(),console.log(r)):Qa(q)};A.src=c}else console.error("Download failed");b=u}};b.open("GET",a,t);b.overrideMimeType&&b.overrideMimeType("text/plain; charset=x-user-defined");
b.send(u)}};aa("cryptogram.demo",$);aa("cryptogram.demo.decrypt",$.decrypt);L&&ua(8);var Ta={"\x00":"&#0;",'"':"&quot;","&":"&amp;","'":"&#39;","<":"&lt;",">":"&gt;","\t":"&#9;","\n":"&#10;","\x0B":"&#11;","\f":"&#12;","\r":"&#13;"," ":"&#32;","-":"&#45;","/":"&#47;","=":"&#61;","`":"&#96;","\u0085":"&#133;","\u00a0":"&#160;","\u2028":"&#8232;","\u2029":"&#8233;"};function Sa(a){return Ta[a]}var Ra=/[\x00\x22\x26\x27\x3c\x3e]/g;var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};"undefined"!=typeof module&&module.za&&(module.za=sjcl);
sjcl.cipher.aes=function(a){this.s[0][0][0]||this.ea();var b,c,d,f,e=this.s[0][4],g=this.s[1];b=a.length;var h=1;4!==b&&(6!==b&&8!==b)&&p(new sjcl.exception.invalid("invalid aes key size"));this.g=[d=a.slice(0),f=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=e[c>>>24]<<24^e[c>>16&255]<<16^e[c>>8&255]<<8^e[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],f[b]=4>=a||4>b?c:g[0][e[c>>>24]]^g[1][e[c>>16&255]]^g[2][e[c>>8&255]]^g[3][e[c&
255]]};
sjcl.cipher.aes.prototype={encrypt:function(a){return Ua(this,a,0)},decrypt:function(a){return Ua(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],ea:function(){var a=this.s[0],b=this.s[1],c=a[4],d=b[4],f,e,g,h=[],m=[],n,k,l,s;for(f=0;256>f;f++)m[(h[f]=f<<1^283*(f>>7))^f]=f;for(e=g=0;!c[e];e^=n||1,g=m[g]||1){l=g^g<<1^g<<2^g<<3^g<<4;l=l>>8^l&255^99;c[e]=l;d[l]=e;k=h[f=h[n=h[e]]];s=16843009*k^65537*f^257*n^16843008*e;k=257*h[l]^16843008*l;for(f=0;4>f;f++)a[f][e]=k=k<<24^k>>>8,b[f][l]=s=s<<24^s>>>8}for(f=
0;5>f;f++)a[f]=a[f].slice(0),b[f]=b[f].slice(0)}};
function Ua(a,b,c){4!==b.length&&p(new sjcl.exception.invalid("invalid aes block size"));var d=a.g[c],f=b[0]^d[0],e=b[c?3:1]^d[1],g=b[2]^d[2],b=b[c?1:3]^d[3],h,m,n=d.length/4-2,k,l=4,s=[0,0,0,0],a=a.s[c],q=a[0],w=a[1],J=a[2],A=a[3],ca=a[4];for(k=0;k<n;k++)a=q[f>>>24]^w[e>>16&255]^J[g>>8&255]^A[b&255]^d[l],h=q[e>>>24]^w[g>>16&255]^J[b>>8&255]^A[f&255]^d[l+1],m=q[g>>>24]^w[b>>16&255]^J[f>>8&255]^A[e&255]^d[l+2],b=q[b>>>24]^w[f>>16&255]^J[e>>8&255]^A[g&255]^d[l+3],l+=4,f=a,e=h,g=m;for(k=0;4>k;k++)s[c?
3&-k:k]=ca[f>>>24]<<24^ca[e>>16&255]<<16^ca[g>>8&255]<<8^ca[b&255]^d[l++],a=f,f=e,e=g,g=b,b=a;return s}
sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.P(a.slice(b/32),32-(b&31)).slice(1);return c===r?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray.P(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===
b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;var a=a.slice(0,Math.ceil(b/32)),c=a.length,b=b&31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return z;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===
c},P:function(a,b,c,d){var f;for(d===r&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(f=0;f<a.length;f++)d.push(c|a[f]>>>b),c=a[f]<<32-b;f=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(f);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},k:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}};
sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,f;for(d=0;d<c/8;d++)0===(d&3)&&(f=a[d/4]),b+=String.fromCharCode(f>>>24),f<<=8;return decodeURIComponent(escape(b))},toBits:function(a){var a=unescape(encodeURIComponent(a)),b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};
sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d,a=a.replace(/\s|0x/g,"");d=a.length;a+="00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};
sjcl.codec.base64={D:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",f=0,e=sjcl.codec.base64.D,g=0,h=sjcl.bitArray.bitLength(a);c&&(e=e.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=e.charAt((g^a[c]>>>f)>>>26),6>f?(g=a[c]<<6-f,f+=26,c++):(g<<=6,f-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){var a=a.replace(/\s|=/g,""),c=[],d=0,f=sjcl.codec.base64.D,e=0,g;b&&(f=f.substr(0,62)+"-_");for(b=0;b<a.length;b++)g=f.indexOf(a.charAt(b)),
0>g&&p(new sjcl.exception.invalid("this isn't base64!")),26<d?(d-=26,c.push(e^g>>>d),e=g<<32-d):(d+=6,e^=g<<32-d);d&56&&c.push(sjcl.bitArray.partial(d&56,e,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.g[0]||this.ea();a?(this.N=a.N.slice(0),this.F=a.F.slice(0),this.p=a.p):this.reset()};sjcl.hash.sha256.hash=function(a){return Va((new sjcl.hash.sha256).update(a))};
sjcl.hash.sha256.prototype={o:512,reset:function(){this.N=this.ma.slice(0);this.F=[];this.p=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.F=sjcl.bitArray.concat(this.F,a);b=this.p;a=this.p=b+sjcl.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)Wa(this,c.splice(0,16));return this},ma:[],g:[],ea:function(){var a=0,b=2,c;a:for(;64>a;b++){for(c=2;c*c<=b;c++)if(0===b%c)continue a;8>a&&(this.ma[a]=4294967296*(Math.pow(b,0.5)-Math.floor(Math.pow(b,
0.5)))|0);this.g[a]=4294967296*(Math.pow(b,1/3)-Math.floor(Math.pow(b,1/3)))|0;a++}}};
function Wa(a,b){for(var c,d,f=b.slice(0),e=a.N,g=a.g,h=e[0],m=e[1],n=e[2],k=e[3],l=e[4],s=e[5],q=e[6],w=e[7],b=0;64>b;b++)16>b?c=f[b]:(c=f[b+1&15],d=f[b+14&15],c=f[b&15]=(c>>>7^c>>>18^c>>>3^c<<25^c<<14)+(d>>>17^d>>>19^d>>>10^d<<15^d<<13)+f[b&15]+f[b+9&15]|0),c=c+w+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(q^l&(s^q))+g[b],w=q,q=s,s=l,l=k+c|0,k=n,n=m,m=h,h=c+(m&n^k&(m^n))+(m>>>2^m>>>13^m>>>22^m<<30^m<<19^m<<10)|0;e[0]=e[0]+h|0;e[1]=e[1]+m|0;e[2]=e[2]+n|0;e[3]=e[3]+k|0;e[4]=e[4]+l|0;e[5]=e[5]+s|0;e[6]=
e[6]+q|0;e[7]=e[7]+w|0}function Va(a){var b,c=a.F,d=a.N,c=sjcl.bitArray.concat(c,[sjcl.bitArray.partial(1,1)]);for(b=c.length+2;b&15;b++)c.push(0);c.push(Math.floor(a.p/4294967296));for(c.push(a.p|0);c.length;)Wa(a,c.splice(0,16));a.reset();return d}
sjcl.mode.ccm={name:"ccm",encrypt:function(a,b,c,d,f){var e,g=b.slice(0),h=sjcl.bitArray,m=h.bitLength(c)/8,n=h.bitLength(g)/8,f=f||64,d=d||[];7>m&&p(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes"));for(e=2;4>e&&n>>>8*e;e++);e<15-m&&(e=15-m);c=h.clamp(c,8*(15-e));b=sjcl.mode.ccm.G(a,b,c,d,f,e);g=sjcl.mode.ccm.I(a,g,c,b,f,e);return h.concat(g.data,g.ca)},decrypt:function(a,b,c,d,f){var f=f||64,d=d||[],e=sjcl.bitArray,g=e.bitLength(c)/8,h=e.bitLength(b),m=e.clamp(b,h-f),n=e.bitSlice(b,
h-f),h=(h-f)/8;7>g&&p(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes"));for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=e.clamp(c,8*(15-b));m=sjcl.mode.ccm.I(a,m,c,n,f,b);a=sjcl.mode.ccm.G(a,m.data,c,d,f,b);e.equal(m.ca,a)||p(new sjcl.exception.corrupt("ccm: tag doesn't match"));return m.data},G:function(a,b,c,d,f,e){var g=[],h=sjcl.bitArray,m=h.k,f=f/8;(f%2||4>f||16<f)&&p(new sjcl.exception.invalid("ccm: invalid tag length"));(4294967295<d.length||4294967295<b.length)&&p(new sjcl.exception.bug("ccm: can't deal with 4GiB or more data"));
e=[h.partial(8,(d.length?64:0)|f-2<<2|e-1)];e=h.concat(e,c);e[3]|=h.bitLength(b)/8;e=a.encrypt(e);if(d.length){c=h.bitLength(d)/8;65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c]));g=h.concat(g,d);for(d=0;d<g.length;d+=4)e=a.encrypt(m(e,g.slice(d,d+4).concat([0,0,0])))}for(d=0;d<b.length;d+=4)e=a.encrypt(m(e,b.slice(d,d+4).concat([0,0,0])));return h.clamp(e,8*f)},I:function(a,b,c,d,f,e){var g,h=sjcl.bitArray;g=h.k;var m=b.length,n=h.bitLength(b),c=h.concat([h.partial(8,
e-1)],c).concat([0,0,0]).slice(0,4),d=h.bitSlice(g(d,a.encrypt(c)),0,f);if(!m)return{ca:d,data:[]};for(g=0;g<m;g+=4)c[3]++,f=a.encrypt(c),b[g]^=f[0],b[g+1]^=f[1],b[g+2]^=f[2],b[g+3]^=f[3];return{ca:d,data:h.clamp(b,n)}}};
sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,f,e){128!==sjcl.bitArray.bitLength(c)&&p(new sjcl.exception.invalid("ocb iv must be 128 bits"));var g,h=sjcl.mode.ocb2.A,m=sjcl.bitArray,n=m.k,k=[0,0,0,0],c=h(a.encrypt(c)),l,s=[],d=d||[],f=f||64;for(g=0;g+4<b.length;g+=4)l=b.slice(g,g+4),k=n(k,l),s=s.concat(n(c,a.encrypt(n(c,l)))),c=h(c);l=b.slice(g);b=m.bitLength(l);g=a.encrypt(n(c,[0,0,0,b]));l=m.clamp(n(l.concat([0,0,0]),g),b);k=n(k,n(l.concat([0,0,0]),g));k=a.encrypt(n(k,n(c,h(c))));d.length&&
(k=n(k,e?d:sjcl.mode.ocb2.pmac(a,d)));return s.concat(m.concat(l,m.clamp(k,f)))},decrypt:function(a,b,c,d,f,e){128!==sjcl.bitArray.bitLength(c)&&p(new sjcl.exception.invalid("ocb iv must be 128 bits"));for(var f=f||64,g=sjcl.mode.ocb2.A,h=sjcl.bitArray,m=h.k,n=[0,0,0,0],k=g(a.encrypt(c)),l,s,q=sjcl.bitArray.bitLength(b)-f,w=[],d=d||[],c=0;c+4<q/32;c+=4)l=m(k,a.decrypt(m(k,b.slice(c,c+4)))),n=m(n,l),w=w.concat(l),k=g(k);s=q-32*c;l=a.encrypt(m(k,[0,0,0,s]));l=m(l,h.clamp(b.slice(c),s).concat([0,0,0]));
n=m(n,l);n=a.encrypt(m(n,m(k,g(k))));d.length&&(n=m(n,e?d:sjcl.mode.ocb2.pmac(a,d)));h.equal(h.clamp(n,f),h.bitSlice(b,q))||p(new sjcl.exception.corrupt("ocb: tag doesn't match"));return w.concat(h.clamp(l,s))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.A,f=sjcl.bitArray,e=f.k,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=e(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=e(g,a.encrypt(e(h,b.slice(c,c+4))));b=b.slice(c);128>f.bitLength(b)&&(h=e(h,d(h)),b=f.concat(b,[-2147483648,0,0,0]));g=e(g,b);return a.encrypt(e(d(e(h,
d(h))),g))},A:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.misc.hmac=function(a,b){this.la=b=b||sjcl.hash.sha256;var c=[[],[]],d=b.prototype.o/32;this.L=[new b,new b];a.length>d&&(a=b.hash(a));for(b=0;b<d;b++)c[0][b]=a[b]^909522486,c[1][b]=a[b]^1549556828;this.L[0].update(c[0]);this.L[1].update(c[1])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.Ha=function(a,b){a=Va((new this.la(this.L[0])).update(a,b));return Va((new this.la(this.L[1])).update(a))};
sjcl.misc.pbkdf2=function(a,b,c,d,f){c=c||1E3;(0>d||0>c)&&p(sjcl.exception.invalid("invalid params to pbkdf2"));"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var f=f||sjcl.misc.hmac,a=new f(a),e,g,h,m,n=[],k=sjcl.bitArray;for(m=1;32*n.length<(d||1);m++){f=e=a.encrypt(k.concat(b,[m]));for(g=1;g<c;g++){e=a.encrypt(e);for(h=0;h<e.length;h++)f[h]^=e[h]}n=n.concat(f)}d&&(n=k.clamp(n,d));return n};
sjcl.random={randomWords:function(a,b){var c=[],b=this.isReady(b),d;0===b&&p(new sjcl.exception.notReady("generator isn't seeded"));b&2&&this.ya(!(b&1));for(b=0;b<a;b+=4)0===(b+1)%65536&&this.ka(),d=this.da(),c.push(d[0],d[1],d[2],d[3]);this.ka();return c.slice(0,a)},setDefaultParanoia:function(a){this.ba=a},addEntropy:function(a,b,c){var c=c||"user",d,f,e=(new Date).valueOf(),g=this.U[c],h=this.isReady();d=this.ha[c];d===r&&(d=this.ha[c]=this.wa++);g===r&&(g=this.U[c]=0);this.U[c]=(this.U[c]+1)%
this.j.length;switch(typeof a){case "number":break;case "object":if(b===r)for(c=b=0;c<a.length;c++)for(f=a[c];0<f;)b++,f>>>=1;this.j[g].update([d,this.ia++,2,b,e,a.length].concat(a));break;case "string":b===r&&(b=a.length);this.j[g].update([d,this.ia++,3,b,e,a.length]);this.j[g].update(a);break;default:p(new sjcl.exception.bug("random: addEntropy only supports number, array or string"))}this.u[g]+=b;this.l+=b;0===h&&(0!==this.isReady()&&this.ja("seeded",Math.max(this.q,this.l)),this.ja("progress",
this.getProgress()))},isReady:function(a){a=this.ga[a!==r?a:this.ba];return this.q&&this.q>=a?80<this.u[0]&&(new Date).valueOf()>this.na?3:1:this.l>=a?2:0},getProgress:function(a){a=this.ga[a?a:this.ba];return this.q>=a?1["0"]:this.l>a?1["0"]:this.l/a},startCollectors:function(){this.M||(window.addEventListener?(window.addEventListener("load",this.O,z),window.addEventListener("mousemove",this.Q,z)):document.attachEvent?(document.attachEvent("onload",this.O),document.attachEvent("onmousemove",this.Q)):
p(new sjcl.exception.bug("can't attach event")),this.M=t)},stopCollectors:function(){this.M&&(window.removeEventListener?(window.removeEventListener("load",this.O,z),window.removeEventListener("mousemove",this.Q,z)):window.detachEvent&&(window.detachEvent("onload",this.O),window.detachEvent("onmousemove",this.Q)),this.M=z)},addEventListener:function(a,b){this.Z[a][this.va++]=b},removeEventListener:function(a,b){var c,a=this.Z[a],d=[];for(c in a)a.hasOwnProperty(c)&&a[c]===b&&d.push(c);for(b=0;b<d.length;b++)c=
d[b],delete a[c]},j:[new sjcl.hash.sha256],u:[0],fa:0,U:{},ia:0,ha:{},wa:0,q:0,l:0,na:0,g:[0,0,0,0,0,0,0,0],m:[0,0,0,0],$:r,ba:6,M:z,Z:{Ia:{},Ja:{}},va:0,ga:[0,48,64,96,128,192,256,384,512,768,1024],da:function(){for(var a=0;4>a&&!(this.m[a]=this.m[a]+1|0,this.m[a]);a++);return this.$.encrypt(this.m)},ka:function(){this.g=this.da().concat(this.da());this.$=new sjcl.cipher.aes(this.g)},xa:function(a){this.g=sjcl.hash.sha256.hash(this.g.concat(a));this.$=new sjcl.cipher.aes(this.g);for(a=0;4>a&&!(this.m[a]=
this.m[a]+1|0,this.m[a]);a++);},ya:function(a){var b=[],c=0,d;this.na=b[0]=(new Date).valueOf()+3E4;for(d=0;16>d;d++)b.push(4294967296*Math.random()|0);for(d=0;d<this.j.length&&!(b=b.concat(Va(this.j[d])),c+=this.u[d],this.u[d]=0,!a&&this.fa&1<<d);d++);this.fa>=1<<this.j.length&&(this.j.push(new sjcl.hash.sha256),this.u.push(0));this.l-=c;c>this.q&&(this.q=c);this.fa++;this.xa(b)},Q:function(a){sjcl.random.addEntropy([a.x||a.clientX||a.offsetX,a.y||a.clientY||a.offsetY],2,"mouse")},O:function(){sjcl.random.addEntropy(new Date,
2,"loadtime")},ja:function(a,b){var c,a=sjcl.random.Z[a],d=[];for(c in a)a.hasOwnProperty(c)&&d.push(a[c]);for(c=0;c<d.length;c++)d[c](b)}};try{var Xa=new Uint32Array(32);crypto.Ga(Xa);sjcl.random.addEntropy(Xa,1024,"crypto['getRandomValues']")}catch(Ya){}
sjcl.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(a,b,c,d){var c=c||{},d=d||{},f=sjcl.json,e=f.c({iv:sjcl.random.randomWords(4,0)},f.defaults),g;f.c(e,c);c=e.adata;"string"===typeof e.salt&&(e.salt=sjcl.codec.base64.toBits(e.salt));"string"===typeof e.iv&&(e.iv=sjcl.codec.base64.toBits(e.iv));(!sjcl.mode[e.mode]||!sjcl.cipher[e.cipher]||"string"===typeof a&&100>=e.iter||64!==e.ts&&96!==e.ts&&128!==e.ts||128!==e.ks&&192!==e.ks&&256!==e.ks||2>e.iv.length||
4<e.iv.length)&&p(new sjcl.exception.invalid("json encrypt: invalid parameters"));"string"===typeof a&&(g=sjcl.misc.cachedPbkdf2(a,e),a=g.key.slice(0,e.ks/32),e.salt=g.salt);"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[e.cipher](a);f.c(d,e);d.key=a;e.ct=sjcl.mode[e.mode].encrypt(g,b,e.iv,c,e.ts);return f.encode(f.V(e,f.defaults))},decrypt:function(a,b,c,d){var c=c||{},d=d||{},f=sjcl.json,b=f.c(f.c(f.c({},f.defaults),
f.decode(b)),c,t),e,c=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)&&p(new sjcl.exception.invalid("json decrypt: invalid parameters"));"string"===typeof a&&(e=sjcl.misc.cachedPbkdf2(a,b),a=e.key.slice(0,b.ks/32),b.salt=e.salt);
"string"===typeof c&&(c=sjcl.codec.utf8String.toBits(c));e=new sjcl.cipher[b.cipher](a);c=sjcl.mode[b.mode].decrypt(e,b.ct,b.iv,c,b.ts);f.c(d,b);d.key=a;return sjcl.codec.utf8String.fromBits(c)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b))switch(b.match(/^[a-z0-9]+$/i)||p(new sjcl.exception.invalid("json encode: invalid property name")),c+=d+'"'+b+'":',d=",",typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+=
'"'+sjcl.codec.base64.fromBits(a[b],1)+'"';break;default:p(new sjcl.exception.bug("json encode: unsupported type"))}return c+"}"},decode:function(a){a=a.replace(/\s/g,"");a.match(/^\{.*\}$/)||p(new sjcl.exception.invalid("json decode: this isn't json!"));var a=a.replace(/^\{|\}$/g,"").split(/,/),b={},c,d;for(c=0;c<a.length;c++)(d=a[c].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||p(new sjcl.exception.invalid("json decode: this isn't json!")),b[d[2]]=d[3]?parseInt(d[3],
10):d[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]);return b},c:function(a,b,c){a===r&&(a={});if(b===r)return a;for(var d in b)b.hasOwnProperty(d)&&(c&&(a[d]!==r&&a[d]!==b[d])&&p(new sjcl.exception.invalid("required parameter overridden")),a[d]=b[d]);return a},V:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},W:function(a,b){var c={},d;for(d=0;d<b.length;d++)a[b[d]]!==r&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;
sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.S={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.S,d,b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{Aa:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=b.salt===r?d.Aa:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};
